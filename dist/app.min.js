"use strict";

(function () {
  var e, r, t, i, a, s;"production" !== process.env.NODE_ENV && require("dotenv").config(), i = require("restify"), s = require("trim"), t = require("request"), e = require("cheerio"), a = i.createServer({ name: "ebay-ending-watcher", version: "1.0.0" }), a.use(i.acceptParser(a.acceptable)), a.use(i.queryParser()), a.use(i.bodyParser()), a.get("/ebay-ending-soon/:name", function (r, i, a) {
    var n, o, l, c;return o = r.params.LH_Complete || 0, l = r.params.LH_Sold || 0, n = r.params.LH_BIN || 0, c = "http://www.ebay.com/sch/i.html?_from=R40&_sacat=0&_nkw=" + r.params.name + "&_sop=1&_udlo=" + r.params.price_low + "&_udhi=" + r.params.price_high + "&LH_Complete=" + o + "&LH_Sold=" + r.params.lh_sold + "&LH_BIN=" + r.params.lh_bin + "&LH_ItemCondition=1000|1500|3000", console.log(c), t(c, function (r, t, a) {
      var n, o, l;200 === t.statusCode && (n = e.load(a), l = function () {
        var e, r, t, i;for (t = n(".sresult").slice(0, 6), i = [], e = 0, r = t.length; r > e; e++) {
          o = t[e], i.push({ title: s(n(o).find("h3.lvtitle").text()), price: parseFloat(s(n(o).find(".lvprice").text()).replace(",", "").replace("$", "")), endsAt: parseInt(n(o).find(".timeleft .timeMs").attr("timems")), itemListingUrl: n(o).find(".lvtitle a").attr("href"), itemPictureUrl: n(o).find(".lvpic img").attr("src") });
        }return i;
      }(), i.send(l));
    }), a();
  }), r = process.env.PORT || 5e3, a.listen(r, function () {
    console.log("%s listening at %s", a.name, a.url);
  });
}).call(undefined);