"use strict";

(function () {
  var e, t, r, i, n, s;"production" !== process.env.NODE_ENV && require("dotenv").config(), i = require("restify"), s = require("trim"), r = require("request"), e = require("cheerio"), n = i.createServer({ name: "ebay-ending-watcher", version: "1.0.0" }), n.use(i.acceptParser(n.acceptable)), n.use(i.queryParser()), n.use(i.bodyParser()), n.get("/ebay-ending-soon/:name", function (t, i, n) {
    return r("http://www.ebay.com/sch/i.html?_from=R40&_sacat=0&_nkw=" + t.params.name + "&_sop=1", function (t, r, n) {
      var a, c, l;200 === r.statusCode && (a = e.load(n), l = function () {
        var e, t, r, i;for (r = a(".sresult").slice(0, 6), i = [], e = 0, t = r.length; t > e; e++) {
          c = r[e], i.push({ title: s(a(c).find("h3.lvtitle").text()), price: parseFloat(s(a(c).find(".lvprice").text()).replace(/\$/, "").replace(/\,/, "")), endsAt: parseInt(a(c).find(".timeleft .timeMs").attr("timems")), itemListingUrl: a(c).find(".lvtitle a").attr("href"), itemPictureUrl: a(c).find(".lvpic img").attr("src") });
        }return i;
      }(), i.send(l));
    }), n();
  }), t = process.env.PORT || 5e3, n.listen(t, function () {
    console.log("%s listening at %s", n.name, n.url);
  });
}).call(undefined);