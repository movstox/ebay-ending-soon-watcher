"use strict";

(function () {
  var e, r, t, i, n, s;"production" !== process.env.NODE_ENV && require("dotenv").config(), i = require("restify"), s = require("trim"), t = require("request"), e = require("cheerio"), n = i.createServer({ name: "ebay-ending-watcher", version: "1.0.0" }), n.use(i.acceptParser(n.acceptable)), n.use(i.queryParser()), n.use(i.bodyParser()), n.get("/ebay-ending-soon/:name", function (r, i, n) {
    return t("http://www.ebay.com/sch/i.html?_from=R40&_sacat=0&_nkw=" + r.params.name + "&_sop=1&_udlo=" + r.params.price_low + "&_udhi=" + r.params.price_high + "&LH_ItemCondition=1000|1500|3000", function (r, t, n) {
      var a, c, o;200 === t.statusCode && (a = e.load(n), o = function () {
        var e, r, t, i;for (t = a(".sresult").slice(0, 6), i = [], e = 0, r = t.length; r > e; e++) {
          c = t[e], i.push({ title: s(a(c).find("h3.lvtitle").text()), price: parseFloat(s(a(c).find(".lvprice").text()).replace(/[\$\,]/, "")), endsAt: parseInt(a(c).find(".timeleft .timeMs").attr("timems")), itemListingUrl: a(c).find(".lvtitle a").attr("href"), itemPictureUrl: a(c).find(".lvpic img").attr("src") });
        }return i;
      }(), i.send(o));
    }), n();
  }), r = process.env.PORT || 5e3, n.listen(r, function () {
    console.log("%s listening at %s", n.name, n.url);
  });
}).call(undefined);